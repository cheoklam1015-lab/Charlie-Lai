
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç„¡é™ç©¿ç‰†è²ªé£Ÿè›‡</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2E7D32;
            --accent-color: #FF5252;
            --bg-color: #1a1a1a;
            --panel-bg: #2d2d2d;
            --text-color: #ffffff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft JhengHei', Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 10px;
            /* èƒŒæ™¯å¾®å¼±ç´‹ç† */
            background-image: radial-gradient(#222 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        /* Header Section */
        .header {
            text-align: center;
            margin-bottom: 15px;
        }
        
        h1 {
            color: var(--primary-color);
            font-size: 2.2rem;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.4);
            letter-spacing: 2px;
        }

        .header p {
            font-size: 0.9rem;
            color: #aaa;
        }
        
        /* Info Panel */
        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 600px;
            margin-bottom: 15px;
            background-color: var(--panel-bg);
            padding: 10px 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid #444;
        }
        
        .info-item {
            font-size: 1rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .score-val { color: var(--primary-color); }
        .high-score-val { color: #FF9800; }
        .speed-val { color: #2196F3; }
        
        /* Game Container */
        .game-container {
            position: relative;
            padding: 4px;
            background: linear-gradient(45deg, #333, #111);
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        
        #gameCanvas {
            background-color: #000;
            border-radius: 6px;
            display: block;
            cursor: pointer;
            /* ç¢ºä¿ç•«å¸ƒæ¸…æ™°åº¦ */
            image-rendering: pixelated; 
        }

        /* Mobile Controls */
        .mobile-controls {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
            width: 180px;
        }

        .d-pad-btn {
            background-color: #333;
            border: 2px solid #555;
            border-radius: 12px;
            height: 55px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: white;
            box-shadow: 0 4px 0 #222;
            transition: transform 0.1s, box-shadow 0.1s;
        }

        .d-pad-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #222;
            background-color: #444;
        }

        .up { grid-column: 2; }
        .left { grid-column: 1; grid-row: 2; }
        .down { grid-column: 2; grid-row: 2; }
        .right { grid-column: 3; grid-row: 2; }

        /* Desktop Buttons */
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
            max-width: 600px;
        }
        
        .btn {
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: white;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }

        .btn:hover { transform: translateY(-2px); opacity: 0.9; }
        .btn:active { transform: translateY(0); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .btn-start { background-color: var(--primary-color); box-shadow: 0 4px 0 var(--secondary-color); }
        .btn-pause { background-color: #FF9800; box-shadow: 0 4px 0 #F57C00; }
        .btn-reset { background-color: #f44336; box-shadow: 0 4px 0 #d32f2f; }
        .btn-home { background-color: #607D8B; box-shadow: 0 4px 0 #455A64; }
        
        /* Instructions */
        .instructions {
            width: 100%;
            max-width: 600px;
            margin-top: 25px;
            background-color: var(--panel-bg);
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 0.9rem;
            line-height: 1.6;
            border: 1px solid #444;
        }
        
        .instructions h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .key {
            display: inline-block;
            background: #444;
            padding: 2px 6px;
            border-radius: 4px;
            border-bottom: 2px solid #222;
            font-family: monospace;
            font-size: 0.85rem;
            margin: 0 2px;
        }

        .feature-highlight {
            color: #2196F3;
            font-weight: bold;
        }

        /* Game Over Modal */
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(4px);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            border-radius: 6px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .game-over.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .game-over h2 {
            color: var(--accent-color);
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 0 0 15px var(--accent-color);
        }
        
        .game-over p {
            font-size: 1.5rem;
            margin-bottom: 25px;
        }

        /* Responsive Queries */
        @media (max-width: 650px) {
            h1 { font-size: 1.8rem; }
            .game-info { padding: 10px; font-size: 0.9rem; }
            
            #gameCanvas {
                width: 95vw;
                height: auto;
                aspect-ratio: 3/2; 
            }

            .controls { display: none; } 
            .mobile-controls { display: grid; } 
            .instructions { display: none; } 
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ç„¡é™ç©¿ç‰†è²ªé£Ÿè›‡</h1>
        <p>è‡ªç”±ç©¿è¶Šé‚Šç•Œ Â· æŒ‘æˆ°é«˜åˆ†</p>
    </div>
    
    <div class="game-info">
        <div class="info-item">åˆ†æ•¸: <span id="score" class="score-val">0</span></div>
        <div class="info-item">æœ€é«˜åˆ†: <span id="highScore" class="high-score-val">0</span></div>
        <div class="info-item">é€Ÿåº¦: <span id="speed" class="speed-val">æ­£å¸¸</span></div>
    </div>
    
    <div class="game-container">
        <canvas id="gameCanvas" width="600" height="400"></canvas>
        
        <div id="gameOver" class="game-over">
            <h2>éŠæˆ²çµæŸ</h2>
            <p>æœ€çµ‚åˆ†æ•¸: <span id="finalScore">0</span></p>
            <button id="restartBtn" class="btn btn-start">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>
    
    <!-- Desktop Controls -->
    <div class="controls">
        <button id="startBtn" class="btn btn-start">é–‹å§‹éŠæˆ²</button>
        <button id="pauseBtn" class="btn btn-pause">æš«åœéŠæˆ²</button>
        <button id="resetBtn" class="btn btn-reset">é‡ç½®éŠæˆ²</button>
        <a href="index.html" class="btn btn-home">è¿”å›ä¸»é </a>
    </div>
    
    <!-- Mobile D-Pad -->
    <div class="mobile-controls">
        <button class="d-pad-btn up" data-dir="up">â–²</button>
        <button class="d-pad-btn left" data-dir="left">â—€</button>
        <button class="d-pad-btn down" data-dir="down">â–¼</button>
        <button class="d-pad-btn right" data-dir="right">â–¶</button>
    </div>
    
    <div class="instructions">
        <h3>ğŸ® éŠæˆ²èªªæ˜</h3>
        <ul style="list-style: none;">
            <li>ğŸ¯ ä½¿ç”¨ <span class="key">æ–¹å‘éµ</span> æˆ– <span class="key">WASD</span> æ§åˆ¶ç§»å‹•</li>
            <li>ğŸŒ€ <span class="feature-highlight">ç©¿ç‰†æ¨¡å¼</span>ï¼šç¢°åˆ°ç‰†å£æœƒå¾å°é¢ç©¿è¶Šï¼Œä¸æœƒæ­»</li>
            <li>ğŸ åƒæ‰ç´…è‰²è˜‹æœè®Šé•·ä¸¦å¾—åˆ† (+10åˆ†)</li>
            <li>âš¡ æ¯5å€‹è˜‹æœé€Ÿåº¦æœƒæå‡ä¸€å€‹ç­‰ç´š</li>
            <li>ğŸ’€ å”¯ä¸€è¦æ³¨æ„çš„æ˜¯ï¼š<span style="color:#FF5252">ä¸è¦æ’åˆ°è‡ªå·±çš„èº«é«”ï¼</span></li>
        </ul>
    </div>

    <script>
        /**
         * éŠæˆ²é…ç½®èˆ‡ç‹€æ…‹ç®¡ç†
         */
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // UI å…ƒç´ 
        const ui = {
            score: document.getElementById('score'),
            highScore: document.getElementById('highScore'),
            finalScore: document.getElementById('finalScore'),
            speed: document.getElementById('speed'),
            gameOver: document.getElementById('gameOver'),
            btns: {
                start: document.getElementById('startBtn'),
                pause: document.getElementById('pauseBtn'),
                reset: document.getElementById('resetBtn'),
                restart: document.getElementById('restartBtn')
            }
        };

        // éŠæˆ²å¸¸æ•¸
        const GRID_SIZE = 20;
        let GRID_W = canvas.width / GRID_SIZE;
        let GRID_H = canvas.height / GRID_SIZE;
        
        // éŠæˆ²è®Šæ•¸
        let snake = [];
        let food = {x: 0, y: 0};
        let direction = 'right';
        let nextDirection = 'right';
        let gameSpeed = 150;
        let gameInterval = null;
        let score = 0;
        let highScore = localStorage.getItem('snakeHighScore') || 0;
        let isPaused = false;
        let isGameRunning = false;
        let speedLevel = 1;

        // åˆå§‹åŒ–é¡¯ç¤ºæœ€é«˜åˆ†
        ui.highScore.textContent = highScore;

        /**
         * æ ¸å¿ƒéŠæˆ²é‚è¼¯
         */

        function initGame() {
            // é‡ç½®è›‡çš„ä½ç½®ï¼ˆå±…ä¸­ï¼‰
            const startX = Math.floor(GRID_W / 4);
            const startY = Math.floor(GRID_H / 2);
            
            snake = [
                {x: startX, y: startY},
                {x: startX - 1, y: startY},
                {x: startX - 2, y: startY}
            ];
            
            direction = 'right';
            nextDirection = 'right';
            score = 0;
            speedLevel = 1;
            gameSpeed = 150;
            
            updateScoreUI();
            generateFood();
            ui.gameOver.classList.remove('active');
            ui.btns.pause.textContent = "æš«åœéŠæˆ²";
            
            draw();
        }

        function startGame() {
            if (isGameRunning && !isPaused) return; 

            if (!isGameRunning) {
                initGame();
            }
            
            isGameRunning = true;
            isPaused = false;
            
            ui.btns.start.disabled = true;
            ui.btns.pause.disabled = false;
            
            if (gameInterval) clearInterval(gameInterval);
            gameInterval = setInterval(gameLoop, gameSpeed);
        }

        function togglePause() {
            if (!isGameRunning) return;

            isPaused = !isPaused;
            
            if (isPaused) {
                clearInterval(gameInterval);
                ui.btns.pause.textContent = "ç¹¼çºŒéŠæˆ²";
                drawPauseScreen();
            } else {
                gameInterval = setInterval(gameLoop, gameSpeed);
                ui.btns.pause.textContent = "æš«åœéŠæˆ²";
            }
        }

        function resetGame() {
            clearInterval(gameInterval);
            isGameRunning = false;
            isPaused = false;
            ui.btns.start.disabled = false;
            ui.btns.pause.disabled = true;
            ui.btns.pause.textContent = "æš«åœéŠæˆ²";
            ui.gameOver.classList.remove('active');
            initGame();
        }

        function gameOver() {
            clearInterval(gameInterval);
            isGameRunning = false;
            ui.btns.start.disabled = false;
            ui.btns.pause.disabled = true;

            // æ›´æ–°æœ€é«˜åˆ†
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('snakeHighScore', highScore);
                ui.highScore.textContent = highScore;
            }

            ui.finalScore.textContent = score;
            ui.gameOver.classList.add('active');
        }

        function gameLoop() {
            if (isPaused) return;
            update();
            draw();
        }

        function update() {
            direction = nextDirection;
            
            // è¨ˆç®—æ–°çš„é ­éƒ¨åº§æ¨™
            const head = { ...snake[0] };

            if (direction === 'right') head.x++;
            else if (direction === 'left') head.x--;
            else if (direction === 'up') head.y--;
            else if (direction === 'down') head.y++;

            // --- ç©¿ç‰†é‚è¼¯ ---
            // å¦‚æœè¶…å‡ºå·¦é‚Šç•Œï¼Œå¾å³é‚Šå‡ºç¾
            if (head.x < 0) head.x = GRID_W - 1;
            // å¦‚æœè¶…å‡ºå³é‚Šç•Œï¼Œå¾å·¦é‚Šå‡ºç¾
            if (head.x >= GRID_W) head.x = 0;
            // å¦‚æœè¶…å‡ºä¸Šé‚Šç•Œï¼Œå¾ä¸‹é‚Šå‡ºç¾
            if (head.y < 0) head.y = GRID_H - 1;
            // å¦‚æœè¶…å‡ºä¸‹é‚Šç•Œï¼Œå¾ä¸Šé‚Šå‡ºç¾
            if (head.y >= GRID_H) head.y = 0;
            // ----------------

            // æª¢æŸ¥æ’åˆ°è‡ªå·±
            for (let segment of snake) {
                if (head.x === segment.x && head.y === segment.y) {
                    return gameOver();
                }
            }

            snake.unshift(head); 

            // æª¢æŸ¥åƒé£Ÿç‰©
            if (head.x === food.x && head.y === food.y) {
                score += 10;
                updateScoreUI();
                generateFood();
                checkSpeedUp();
            } else {
                snake.pop(); 
            }
        }

        function checkSpeedUp() {
            if (score % 50 === 0 && score > 0) {
                speedLevel++;
                gameSpeed = Math.max(50, gameSpeed - 15);
                
                let speedText = 'æ­£å¸¸';
                if (speedLevel === 2) speedText = 'å¿«é€Ÿ';
                if (speedLevel === 3) speedText = 'ç˜‹ç‹‚';
                if (speedLevel >= 4) speedText = 'æ¥µé€Ÿ';
                ui.speed.textContent = speedText;

                clearInterval(gameInterval);
                gameInterval = setInterval(gameLoop, gameSpeed);
            }
        }

        function updateScoreUI() {
            ui.score.textContent = score;
        }

        function generateFood() {
            let valid = false;
            while (!valid) {
                food.x = Math.floor(Math.random() * GRID_W);
                food.y = Math.floor(Math.random() * GRID_H);
                
                valid = true;
                for (let segment of snake) {
                    if (segment.x === food.x && segment.y === food.y) {
                        valid = false;
                        break;
                    }
                }
            }
        }

        /**
         * ç¹ªåœ–å‡½æ•¸
         */
        function draw() {
            // èƒŒæ™¯
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ç¹ªè£½æ ¼ç·š
            drawGrid();

            // é£Ÿç‰©
            drawFood();

            // è›‡
            drawSnake();
        }

        function drawGrid() {
            // è¨­å®šè¼ƒæ˜é¡¯çš„é¡è‰²
            ctx.strokeStyle = '#333'; 
            ctx.lineWidth = 1;
            
            ctx.beginPath();
            // å‚ç›´ç·š
            for (let x = 0; x <= canvas.width; x += GRID_SIZE) {
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
            }
            // æ°´å¹³ç·š
            for (let y = 0; y <= canvas.height; y += GRID_SIZE) {
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
            }
            ctx.stroke();
        }

        function drawSnake() {
            snake.forEach((segment, index) => {
                const x = segment.x * GRID_SIZE;
                const y = segment.y * GRID_SIZE;
                
                // é¡è‰²æ¼¸è®Š
                if (index === 0) {
                    ctx.fillStyle = '#4CAF50'; // é ­éƒ¨
                } else {
                    const greenVal = 100 + Math.floor(100 * (1 - index/snake.length));
                    ctx.fillStyle = `rgb(30, ${greenVal}, 30)`;
                }
                
                // ç•«åœ“è§’çŸ©å½¢
                roundRect(ctx, x + 1, y + 1, GRID_SIZE - 2, GRID_SIZE - 2, 4);
                
                // ç•«çœ¼ç› (å¦‚æœæ˜¯é ­éƒ¨)
                if (index === 0) {
                    drawEyes(x, y);
                }
            });
        }

        function drawEyes(x, y) {
            ctx.fillStyle = '#fff';
            const eyeSize = 3;
            const pupilSize = 1.5;
            
            let eyeLeftX, eyeLeftY, eyeRightX, eyeRightY;
            
            // æ ¹æ“šæ–¹å‘èª¿æ•´çœ¼ç›ä½ç½®
            if (direction === 'right') {
                eyeLeftX = x + 14; eyeLeftY = y + 5;
                eyeRightX = x + 14; eyeRightY = y + 15;
            } else if (direction === 'left') {
                eyeLeftX = x + 6; eyeLeftY = y + 5;
                eyeRightX = x + 6; eyeRightY = y + 15;
            } else if (direction === 'up') {
                eyeLeftX = x + 5; eyeLeftY = y + 6;
                eyeRightX = x + 15; eyeRightY = y + 6;
            } else if (direction === 'down') {
                eyeLeftX = x + 5; eyeLeftY = y + 14;
                eyeRightX = x + 15; eyeRightY = y + 14;
            }

            // çœ¼ç™½
            ctx.beginPath(); ctx.arc(eyeLeftX, eyeLeftY, eyeSize, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(eyeRightX, eyeRightY, eyeSize, 0, Math.PI*2); ctx.fill();
            
            // çœ¼ç 
            ctx.fillStyle = '#000';
            ctx.beginPath(); ctx.arc(eyeLeftX, eyeLeftY, pupilSize, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(eyeRightX, eyeRightY, pupilSize, 0, Math.PI*2); ctx.fill();
        }

        function drawFood() {
            const x = food.x * GRID_SIZE + GRID_SIZE/2;
            const y = food.y * GRID_SIZE + GRID_SIZE/2;
            
            ctx.fillStyle = '#FF5252';
            ctx.beginPath();
            ctx.arc(x, y, GRID_SIZE/2 - 2, 0, Math.PI*2);
            ctx.fill();
            
            ctx.fillStyle = '#4CAF50';
            ctx.beginPath();
            ctx.ellipse(x + 2, y - 5, 4, 2, Math.PI/4, 0, Math.PI*2);
            ctx.fill();
        }

        function roundRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
            ctx.fill();
        }
        
        function drawPauseScreen() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#fff';
            ctx.font = '30px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('å·²æš«åœ', canvas.width/2, canvas.height/2);
        }

        /**
         * äº‹ä»¶ç›£è½
         */
        
        document.addEventListener('keydown', (e) => {
            const key = e.keyCode;
            
            if ([32, 37, 38, 39, 40].includes(key)) {
                e.preventDefault();
            }

            if (!isGameRunning && key === 13) { 
                startGame();
                return;
            }
            if (key === 32) { 
                togglePause();
                return;
            }

            const goingUp = direction === 'up';
            const goingDown = direction === 'down';
            const goingRight = direction === 'right';
            const goingLeft = direction === 'left';

            if ((key === 37 || key === 65) && !goingRight) nextDirection = 'left';
            if ((key === 38 || key === 87) && !goingDown) nextDirection = 'up';
            if ((key === 39 || key === 68) && !goingLeft) nextDirection = 'right';
            if ((key === 40 || key === 83) && !goingUp) nextDirection = 'down';
        });

        ui.btns.start.addEventListener('click', startGame);
        ui.btns.pause.addEventListener('click', togglePause);
        ui.btns.reset.addEventListener('click', resetGame);
        ui.btns.restart.addEventListener('click', startGame);

        // è§¸æ§æ§åˆ¶
        document.querySelectorAll('.d-pad-btn').forEach(btn => {
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault(); 
                handleMobileInput(btn.dataset.dir);
            }, {passive: false});

            btn.addEventListener('click', () => {
                handleMobileInput(btn.dataset.dir);
            });
        });

        function handleMobileInput(dir) {
            if (!isGameRunning && !isPaused) return;
            
            const goingUp = direction === 'up';
            const goingDown = direction === 'down';
            const goingRight = direction === 'right';
            const goingLeft = direction === 'left';

            if (dir === 'left' && !goingRight) nextDirection = 'left';
            if (dir === 'up' && !goingDown) nextDirection = 'up';
            if (dir === 'right' && !goingLeft) nextDirection = 'right';
            if (dir === 'down' && !goingUp) nextDirection = 'down';
            
            if (isPaused) togglePause();
        }

        function resizeCanvas() {
            // è¦–è¦ºç¸®æ”¾ç”± CSS è™•ç†
        }
        window.addEventListener('resize', resizeCanvas);
        
        // åˆå§‹ç¹ªè£½
        initGame();

    </script>
</body>
</html>
```